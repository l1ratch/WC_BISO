<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Анализ задания практики 7 и теоретические пояснения</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
        }
        h1, h2 {
            color: #FFD700;
        }
        h3 {
            color: #00BFFF;
        }
        .task, .answer {
            background-color: #333;
            padding: 15px;
            margin: 10px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }
        .important {
            background-color: #ff6347;
            padding: 10px;
            border-radius: 5px;
        }
        .question {
            font-weight: bold;
            color: #ADD8E6;
        }
        code {
            background-color: #555;
            padding: 2px 5px;
            font-size: 1.1em;
        }
        ul {
            list-style-type: square;
        }
        li {
            margin: 10px;
        }
        hr {
            border: 1px solid #444;
        }
    </style>
</head>
<body>

    <h1>Анализ задания практики 7 и теоретические пояснения</h1>

    <p>Задание состоит из нескольких частей, каждая из которых нацелена на создание и управление объектами PostgreSQL, такими как представления, функции, процедуры и триггеры. Далее приводится анализ, теоретическое пояснение и ответы на каверзные вопросы.</p>

    <hr>

    <h2>1. Создание представления (CREATE VIEW)</h2>
    <div class="task">
        <p><strong>Теоретическое объяснение:</strong></p>
        <p>- Представление (view) — это виртуальная таблица, которая формируется на основе результата SQL-запроса. Оно не хранит данных самостоятельно, а действует как слой абстракции, позволяя упрощать сложные запросы и скрывать сложность данных.</p>
        <p>- Представления полезны для:
            <ul>
                <li>Обеспечения безопасности (скрытия столбцов или данных).</li>
                <li>Сокращения повторения сложных запросов.</li>
                <li>Создания предопределенных структур для удобной выборки данных.</li>
            </ul>
        </p>
    </div>

    <div class="important">Ответы на вопросы:</div>
    <div class="answer">
        <p class="question">Можно ли обновлять данные через представление?</p>
        <p>- Да, если представление соответствует требованиям для обновляемых представлений: оно не должно использовать агрегации, группировок или соединений с несколькими таблицами. В противном случае можно использовать <code>INSTEAD OF</code> триггеры.</p>

        <p class="question">Чем отличается представление от таблицы?</p>
        <p>- Таблица хранит данные физически, а представление генерирует данные на основе запроса.</p>

        <p class="question">Какова производительность представления?</p>
        <p>- Представление выполняется каждый раз при вызове. Для больших данных может быть полезно использовать материализованные представления (<code>MATERIALIZED VIEW</code>), которые сохраняют результат запроса.</p>
    </div>

    <hr>

    <h2>2. Процедуры для вставки, обновления и удаления</h2>
    <div class="task">
        <p><strong>Теоретическое объяснение:</strong></p>
        <p>- Процедура — это объект базы данных, который содержит набор SQL-команд, выполняемых в определенном порядке. Процедуры создаются с помощью <code>CREATE PROCEDURE</code> и вызываются командой <code>CALL</code>.</p>
        <p>- Процедуры могут:
            <ul>
                <li>Выполнять сложные транзакции.</li>
                <li>Упрощать повторяющиеся действия.</li>
                <li>Принимать входные параметры и обрабатывать данные на их основе.</li>
            </ul>
        </p>
    </div>

    <div class="important">Ответы на вопросы:</div>
    <div class="answer">
        <p class="question">Чем отличается процедура от функции?</p>
        <p>- Процедуры не возвращают значения, а функции всегда возвращают результат. Процедуры вызываются через <code>CALL</code>, а функции через <code>SELECT</code>.</p>

        <p class="question">Можно ли использовать транзакции внутри процедуры?</p>
        <p>- Да, но они управляются блоками <code>BEGIN ... COMMIT</code> внутри процедуры.</p>

        <p class="question">Что произойдёт, если процедура завершится ошибкой?</p>
        <p>- Все операции внутри процедуры будут откатаны, если используется транзакция.</p>
    </div>

    <hr>

    <h2>3. Скалярная функция</h2>
    <div class="task">
        <p><strong>Теоретическое объяснение:</strong></p>
        <p>- Скалярная функция возвращает одно значение, обычно на основе входных данных или выполнения SQL-запроса.</p>
        <p>- Скалярные функции используются для:
            <ul>
                <li>Выполнения вычислений.</li>
                <li>Получения конкретной информации из таблиц.</li>
                <li>Инкапсуляции логики для многократного использования.</li>
            </ul>
        </p>
    </div>

    <div class="important">Ответы на вопросы:</div>
    <div class="answer">
        <p class="question">Можно ли вернуть несколько значений из скалярной функции?</p>
        <p>- Нет, скалярная функция возвращает только одно значение. Для нескольких значений нужно использовать табличные функции.</p>

        <p class="question">Чем скалярные функции отличаются от агрегатных?</p>
        <p>- Скалярные функции работают с одной строкой входных данных, а агрегатные (например, <code>MAX</code>, <code>SUM</code>) применяются к набору строк.</p>

        <p class="question">Можно ли использовать скалярные функции в <code>WHERE</code> или <code>JOIN</code>?</p>
        <p>- Да, но их использование может снизить производительность из-за частого вызова функции.</p>
    </div>

    <hr>

    <h2>4. Табличная функция</h2>
    <div class="task">
        <p><strong>Теоретическое объяснение:</strong></p>
        <p>- Табличная функция возвращает результат в виде таблицы. Это особенно полезно для создания динамических наборов данных.</p>
        <p>- В PostgreSQL они создаются с помощью <code>RETURNS TABLE</code> и содержат запросы внутри тела функции.</p>
    </div>

    <div class="important">Ответы на вопросы:</div>
    <div class="answer">
        <p class="question">Можно ли параметризовать табличные функции?</p>
        <p>- Да, параметры позволяют динамически изменять логику выполнения функции. Например, добавление параметра для фильтрации данных.</p>

        <p class="question">Как табличные функции отличаются от представлений?</p>
        <p>- Табличные функции возвращают результат, который может быть параметризован, тогда как представления статичны.</p>

        <p class="question">Можно ли использовать табличные функции в <code>JOIN</code>?</p>
        <p>- Да, они могут быть частью выражений <code>FROM</code> или соединяться с другими таблицами.</p>
    </div>

    <hr>

    <h2>5. Функция с типом VOID</h2>
    <div class="task">
        <p><strong>Теоретическое объяснение:</strong></p>
        <p>- Функция с типом <code>VOID</code> не возвращает значения, но выполняет операции, аналогичные процедурам.</p>
        <p>- Используется, когда необходимо выполнить действие без получения результата.</p>
    </div>

    <div class="important">Ответы на вопросы:</div>
    <div class="answer">
        <p class="question">Почему использовать функцию вместо процедуры для удаления?</p>
        <p>- Функции можно вызывать через <code>SELECT</code>, что иногда удобнее.</p>

        <p class="question">Как управлять транзакциями в VOID-функциях?</p>
        <p>- Транзакции управляются на уровне вызова функции или с помощью триггеров.</p>
    </div>

    <hr>

    <h2>6. Триггер BEFORE INSERT</h2>
    <div class="task">
        <p><strong>Теоретическое объяснение:</strong></p>
        <p>- Триггер <code>BEFORE INSERT</code> срабатывает до добавления данных. Используется для проверки данных, их модификации или предотвращения операций.</p>
        <p>- Пример: запрет вставки данных.</p>
    </div>

    <div class="important">Ответы на вопросы:</div>
    <div class="answer">
        <p class="question">Что произойдёт, если триггер не возвращает значения?</p>
        <p>- Если триггер не возвращает измененные данные или NULL, операция прервется.</p>

        <p class="question">Можно ли изменить данные в триггере?</p>
        <p>- Да, для этого нужно вернуть измененный <code>NEW</code>.</p>

        <p class="question">Как избежать срабатывания триггера?</p>
        <p>- Триггер можно временно отключить через <code>ALTER TABLE DISABLE TRIGGER</code>.</p>
    </div>

    <hr>

    <h2>7. Триггер AFTER DELETE</h2>
    <div class="task">
        <p><strong>Теоретическое объяснение:</strong></p>
        <p>- Триггер <code>AFTER DELETE</code> срабатывает после удаления записи и обычно используется для логирования или дополнительных действий.</p>
        <p>- Пример: вывод информации об удаленной записи.</p>
    </div>

    <div class="important">Ответы на вопросы:</div>
    <div class="answer">
        <p class="question">Можно ли откатить операцию DELETE через AFTER триггер?</p>
        <p>- Нет, AFTER триггер выполняется после завершения операции. Для откатов используйте <code>BEFORE</code> триггеры.</p>

        <p class="question">Может ли триггер вызывать другую операцию, которая вызовет новый триггер?</p>
        <p>- Да, это называется каскадным триггером. Однако это может привести к зацикливанию.</p>

        <p class="question">Что будет, если удалить таблицу с триггером?</p>
        <p>- Все триггеры, связанные с таблицей, будут автоматически удалены.</p>
    </div>

    <hr>

    <h2>Заключение</h2>
    <p>Практика охватывает ключевые аспекты работы с PostgreSQL, включая создание, использование и управление представлениями, функциями, процедурами и триггерами.</p>

    <div class="important">Основные каверзные вопросы по всей работе:</div>
    <div class="answer">
        <p class="question">Почему важно тестировать процедуры и триггеры?</p>
        <p>- Потому что они выполняют действия автоматически и могут повлиять на целостность данных.</p>

        <p class="question">Что происходит с триггерами и функциями при изменении структуры таблицы?</p>
        <p>- Если триггер или функция ссылаются на удаленный или измененный столбец, это приведет к ошибке.</p>

        <p class="question">Как защитить функции и процедуры от некорректного вызова?</p>
        <p>- Использовать проверку входных параметров внутри функций и процедур.</p>
    </div>

</body>
</html>
